// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Office {
  office_id Int @id @default(autoincrement())
  office_street_address String @db.VarChar(100)
  office_city String @db.VarChar(25)
  office_county String @db.VarChar(50)
  office_postal_code String @db.VarChar(10)
  office_manager_id Int 
}

model Employee {
  emp_id Int @id @default(autoincrement())
  emp_name String @db.VarChar(75)
  emp_gender String @db.VarChar(10)
  emp_phone_no String @db.Char(10)
  emp_email String @db.VarChar(30)

  employee Employee @relation(name: "ManagerId", fields: [emp_manager_id], references: [emp_id])
  emp_manager_id Int 
  Employee Employee[] @relation(name: "ManagerId")

  assigned_vehicle AssignedVehicles? @relation(name: "Instructor")
  employee_pos EmployeePositions? @relation(name: "EmployeeHoldingPosition")
  client Client[] @relation(name: "ClientInstructor")
}

model Positions {
  emp_pos_id Int @id @default(autoincrement())
  emp_post_name POSITION @default(INSTRUCTOR)

  employee_pos EmployeePositions? @relation(name: "EmployeeHeldPosition")
}

model EmployeePositions {
  employee Employee @relation(name: "EmployeeHoldingPosition", fields: [emp_id], references: [emp_id])
  emp_id Int @unique
  
  position Positions @relation(name: "EmployeeHeldPosition", fields: [pos_id], references: [emp_pos_id])
  pos_id Int @unique
}

model Vehicle {
  vehicle_license_no String @db.Char(8) @id
  vehicle_make String @db.VarChar(25)
  vehicle_model String @db.VarChar(25)
  vehicle_year String @db.Char(4)
  vehicle_color String @db.VarChar(15)
  vehicle_last_inspection DateTime @db.Date()

  assigned_vehicle AssignedVehicles? @relation(name: "AssignedVehicle")
}

model AssignedVehicles {
  instructor Employee @relation(name: "Instructor", fields: [inst_id], references: [emp_id])
  inst_id Int @unique
  
  vehicle Vehicle @relation(name: "AssignedVehicle", fields: [assigned_vehicle_no], references: [vehicle_license_no])
  assigned_vehicle_no String @db.Char(8) @unique

  @@id(name: "InstructorAssignedVehicle", [inst_id, assigned_vehicle_no])
}

model Client {
  client_id Int @id @default(autoincrement())
  client_name String @db.VarChar(100)
  client_gender String @db.VarChar(10)
  client_phone_no String @db.Char(10)
  client_email String @db.VarChar(100)
  
  instructor Employee @relation(name: "ClientInstructor", fields: [client_inst_id], references: [emp_id])
  client_inst_id Int 

  client_emergency_contact_name String @db.VarChar(100)
  client_emergency_contact_no String @db.Char(10)
  client_interviewed Boolean @default(false)
}

enum POSITION {
  MANAGER
  SENIOR_INSTRUCTOR
  INSTRUCTOR
  ADMIN
}